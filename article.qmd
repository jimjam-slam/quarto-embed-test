---
title: "My quick Quarto embedding test"
author: "James Goldie"
date: "2022-03-11"
---

Quarto looks really cool, but I want to see if I can do an analysis in R with it, send that visualisation to Observable JS, and then pass a version of the visusalisation onto a separate HTML file so that I have an embeddable version. Let's give it a go!

## The analysis

I'm going to analyse the consumption of ozone-depleting substances, courtest of [Our World In Data](https://ourworldindata.org/ozone-layer):

```{r import}
library(tidyverse)
library(here)

ozone <-
  read_csv(here("data", "o3-depleting-substances.csv")) %>%
  set_names(c("country", "code", "year", "consumption"))

ojs_define(ozone = ozone)
ojs_define(country_list = ozone$country %>% unique())
ozone
```

## The visualisation

Okay, now let's chart it using Observable Plot! And to make things a little trickier, let's throw a dropdown menu for the country in. To make things easier for myself, I grabbed the list of country names from the data above in R, rather than trying to do that kind of analysis in JS (although I guess I could just do it with `d3`, as the [Observable Inputs README](https://github.com/observablehq/inputs#Select) demonstrates).

```{ojs ausplot}
viewof countrySelect = Inputs.select(country_list, {label: "Pick a country:"});

filteredOzone = transpose(ozone).filter(function(row) {
  return row.country == countrySelect;
})

ozoneChart = Plot.plot({
  marks: [
    // horizontal line at y = 0
    Plot.ruleY([0]),
    // bars of consumption p. yr
    Plot.barY(filteredOzone, {x: "year", y: "consumption"})
  ]
});
```

Nice! Now check out `embedded-ozone.qmd` for the embeddable version!